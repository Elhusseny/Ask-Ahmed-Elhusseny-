from flask import Flask, request, jsonify
import pandas as pd
import difflib
import os

app = Flask(__name__)

# ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙˆØ§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª
df = pd.read_csv('Ø£Ø³Ø¦Ù„Ø©_Ù…Ù‚ØªØ±Ø­Ø©_Ù„Ø£Ø­Ù…Ø¯_Ø§Ù„Ø­Ø³ÙŠÙ†ÙŠ.csv')

# ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¹Ù…ÙˆØ¯ÙŠÙ† Ù„Ù‚ÙˆØ§Ø¦Ù…
questions = df['question'].tolist()
answers = df['answer'].tolist()
audio_paths = df['audio_path'].tolist()

def find_best_match(user_input):
    matches = difflib.get_close_matches(user_input, questions, n=1, cutoff=0.6)
    if matches:
        idx = questions.index(matches[0])
        return {
            'question': questions[idx],
            'answer': answers[idx],
            'audio': audio_paths[idx]
        }
    else:
        return {
            'question': None,
            'answer': "Ù…Ø¹Ø±ÙØ´ Ø£Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¯Ù‡ Ø¯Ù„ÙˆÙ‚ØªÙŠØŒ Ø¬Ø±Ø¨ ØªØ³Ø£Ù„Ù†ÙŠ Ø¨Ø´ÙƒÙ„ ØªØ§Ù†ÙŠ ğŸ˜Š",
            'audio': None
        }

@app.route('/ask', methods=['POST'])
def ask():
    data = request.get_json()
    user_input = data.get('question', '')