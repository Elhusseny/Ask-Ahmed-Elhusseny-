from flask import Flask, request, jsonify
import pandas as pd
import difflib
import os

app = Flask(__name__)

# تحميل بيانات الأسئلة والإجابات
df = pd.read_csv('أسئلة_مقترحة_لأحمد_الحسيني.csv')

# تحويل العمودين لقوائم
questions = df['question'].tolist()
answers = df['answer'].tolist()
audio_paths = df['audio_path'].tolist()

def find_best_match(user_input):
    matches = difflib.get_close_matches(user_input, questions, n=1, cutoff=0.6)
    if matches:
        idx = questions.index(matches[0])
        return {
            'question': questions[idx],
            'answer': answers[idx],
            'audio': audio_paths[idx]
        }
    else:
        return {
            'question': None,
            'answer': "معرفش أرد على السؤال ده دلوقتي، جرب تسألني بشكل تاني 😊",
            'audio': None
        }

@app.route('/ask', methods=['POST'])
def ask():
    data = request.get_json()
    user_input = data.get('question', '')